<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dynamic Products</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .product-card {
        max-width: 250px;
        margin: 0 auto 20px;
        border-radius: 12px;
        overflow: hidden;
        transition: transform 0.2s ease;
      }
      .product-card:hover {
        transform: scale(1.05);
      }
      .product-img {
        object-fit: cover;
        height: 200px;
      }
      .product-title {
        font-size: 1.1rem;
        font-weight: 600;
        text-decoration: underline;
      }
      .price {
        font-size: 1rem;
        color: #198754;
        font-weight: 500;
      }
      .qty-box {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
        margin-top: 10px;
      }
      .qty-btn {
        width: 32px;
        height: 32px;
        padding: 0;
        font-size: 1.2rem;
        border-radius: 50%;
      }
      .qty-value {
        min-width: 24px;
        text-align: center;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div class="container mt-3">
      <h3 class="mb-3">Our Products</h3>

      <!-- Loader -->
      <div id="loader" class="text-center my-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <div class="row g-2" id="productContainer"></div>
    </div>

    <script>
      const container = document.getElementById("productContainer");
      const loader = document.getElementById("loader");

      // Function to save quantity to localStorage
      function saveQuantity(name, qty) {
        const stored = JSON.parse(localStorage.getItem("productQty")) || {};
        stored[name] = qty;
        localStorage.setItem("productQty", JSON.stringify(stored));
      }

      // Function to get quantity from localStorage
      function getQuantity(name) {
        const stored = JSON.parse(localStorage.getItem("productQty")) || {};
        return stored[name] || 0;
      }

      // Function to render products dynamically
      function renderProducts(productList) {
        container.innerHTML = "";
        productList.forEach((p) => {
          const col = document.createElement("div");
          col.className = "col-md-4 col-sm-6 p-0";

          col.innerHTML = `
          <div class="card product-card shadow-sm">
            <img src="${p.img}" class="card-img-top product-img" alt="${p.name}">
            <div class="card-body text-center">
              <div class="product-title">${p.name}</div>
              <div class="price">&#8377;${p.price}</div>
              <div class="qty-box">
                <button class="btn btn-outline-primary qty-btn dec">-</button>
                <span class="qty-value">0</span>
                <button class="btn btn-outline-primary qty-btn inc">+</button>
              </div>
            </div>
          </div>
        `;

          // Quantity button logic
          let qty = getQuantity(p.name);
          const qtySpan = col.querySelector(".qty-value");
          qtySpan.textContent = qty;

          col.querySelector(".inc").onclick = () => {
            qty++;
            qtySpan.textContent = qty;
            saveQuantity(p.name, qty);
          };

          col.querySelector(".dec").onclick = () => {
            if (qty > 0) {
              qty--;
              qtySpan.textContent = qty;
              saveQuantity(p.name, qty);
            }
          };

          container.appendChild(col);
        });
      }

      // AJAX to fetch products.json
      const xhr = new XMLHttpRequest();
      xhr.open("GET", "products.json", true);
      xhr.onload = function () {
        loader.style.display = ""; // hide loader
        if (xhr.status === 200) {
          const productsFromJSON = JSON.parse(xhr.responseText);
          renderProducts(productsFromJSON);
        } else {
          console.error("Error loading products");
          container.innerHTML =
            "<p class='text-danger'>Failed to load products.</p>";
        }
      };
      xhr.onerror = function () {
        loader.style.display = "none";
        console.error("Request failed");
        container.innerHTML =
          "<p class='text-danger'>Failed to load products.</p>";
      };
      xhr.send();
    </script>
  </body>
</html>
